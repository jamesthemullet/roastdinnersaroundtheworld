---
import BaseLayout from "../layouts/BaseLayout.astro";
const response = await fetch(
  "https://www.roastdinnersaroundtheworld.com/wp-json/wp/v2/posts?_fields=author,id,excerpt,title,link,date,featured_media,tags"
);
let posts = await response.json();

posts = await Promise.all(
  posts.map(async (post) => {
    const mediaResponse = await fetch(
      `https://www.roastdinnersaroundtheworld.com/wp-json/wp/v2/media/${post.featured_media}`
    );
    const media = await mediaResponse.json();
    return {
      ...post,
      featured_image: media.media_details.sizes.large.source_url,
    };
  })
);

console.log(10, posts);
---

<BaseLayout pageTitle='Home'>
  <p>Roast Dinners Around The World</p>
  <ul>
    {
      posts.map((post) => (
        <li>
          <a href={post.link} target='_blank' rel='noopener noreferrer'>
            {post.title.rendered}
          </a>
          <p>{post.excerpt.rendered}</p>
          <img src={post.featured_image} alt={post.title.rendered} />
        </li>
      ))
    }
  </ul>
</BaseLayout>
