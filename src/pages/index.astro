---
import { Image } from "astro:assets";
import BaseLayout from "../layouts/BaseLayout.astro";
const response = await fetch(
  "https://www.roastdinnersaroundtheworld.com/wp-json/wp/v2/posts?_fields=author,id,excerpt,title,link,date,featured_media,tags"
);
let posts = await response.json();

posts = await Promise.all(
  posts.map(async (post) => {
    const mediaResponse = await fetch(
      `https://www.roastdinnersaroundtheworld.com/wp-json/wp/v2/media/${post.featured_media}`
    );
    const media = await mediaResponse.json();
    console.log(10, media.media_details.sizes.largey);
    return {
      ...post,
      featured_image: media.media_details.sizes.medium_large.source_url,
    };
  })
);

console.log(10, posts);
---

<BaseLayout pageTitle='Home'>
  <p>Roast Dinners Around The World</p>
  <ul>
    {
      posts.map((post, index) => (
        <li>
          <a href={post.link} target='_blank' rel='noopener noreferrer'>
            {post.title.rendered}
          </a>
          <Fragment set:html={post.excerpt.rendered} />
          <Image
            src={post.featured_image}
            alt={post.title.rendered}
            width={768}
            height={576}
            loading={index < 3 ? "eager" : "lazy"}
          />
        </li>
      ))
    }
  </ul>
</BaseLayout>
